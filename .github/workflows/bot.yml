name: Telegram Bot Host (15 Sessions)

on:
  workflow_dispatch:        # manually run from Actions tab
  push:                     # jab bhi main branch pe push karo
    branches: [ main ]
  schedule:                 # approx 24x7 ke liye
    - cron: "*/55 * * * *"  # har 55 minute me automatically restart

jobs:
  run-bot:
    name: Session ${{ matrix.session }}
    runs-on: ubuntu-latest

    strategy:
      matrix:
        session: [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15]
      max-parallel: 15       # GitHub free ka limit 15 hi hai

    timeout-minutes: 350     # ~5.8 hours per job (max 6h hota hai)

    env:
      BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
      OWNER_ID:  ${{ secrets.OWNER_ID }}
      ADMIN_ID:  ${{ secrets.ADMIN_ID }}
      PORT: 8080

    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.11"

      - name: Install dependencies
        run: |
          python -m pip install --upgrade pip
          pip install -r requirements.txt

      - name: Run Telegram bot host
        run: |
          python main.py
          
